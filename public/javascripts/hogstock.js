// Generated by CoffeeScript 1.6.2
(function() {
  $(function() {
    var $menu, buildThumbs, contactHandler, item, makeScrollable, menuAction, menuLinks, sideHomeHandler, sideMenuAction, sideMenuHandler, testimonials, thumbClickHandler, _i, _len;
    testimonials = function() {
      var displayTestimonial, elementList, loadXMLdoc, rndm, rndnumber, x;
      displayTestimonial = function() {
        var displayQuote, rndm;
        displayQuote = function() {
          document.getElementById("testimonials_txt").innerHTML = x.getElementsByTagName("quote")[rndm].childNodes[0].nodeValue;
          document.getElementById("testimonials_name").innerHTML = x.getElementsByTagName("author")[rndm].childNodes[0].nodeValue;
          return document.getElementById("testimonials_department").innerHTML = x.getElementsByTagName("department")[rndm].childNodes[0].nodeValue;
        };
        $("#testimonials_container").fadeOut("slow");
        rndm = rndnumber();
        setTimeout(displayQuote, 500);
        return $("#testimonials_container").fadeIn("slow");
      };
      loadXMLdoc = function() {
        var xmlDoc;
        xmlDoc = void 0;
        if (window.XMLHttpRequest) {
          xmlDoc = new window.XMLHttpRequest();
          xmlDoc.open("GET", "/xml/testimonials.xml", false);
          xmlDoc.send("");
          return xmlDoc.responseXML;
        }
        return alert("Error loading document");
      };
      rndnumber = function() {
        var randscript;
        randscript = -1;
        while (randscript < 0 || randscript > elementList.length - 1) {
          randscript = parseInt(Math.random() * (elementList.length + 1));
        }
        return randscript;
      };
      x = void 0;
      elementList = void 0;
      rndm = void 0;
      x = loadXMLdoc();
      elementList = x.getElementsByTagName("id");
      rndm = rndnumber();
      document.getElementById("testimonials_txt").innerHTML = x.getElementsByTagName("quote")[rndm].childNodes[0].nodeValue;
      document.getElementById("testimonials_name").innerHTML = x.getElementsByTagName("author")[rndm].childNodes[0].nodeValue;
      document.getElementById("testimonials_department").innerHTML = x.getElementsByTagName("department")[rndm].childNodes[0].nodeValue;
      return setInterval(displayTestimonial, 10000);
    };
    $(window).resize(function() {
      if ($("#st_nav").is(":visible")) {
        return makeScrollable();
      }
    });
    buildThumbs = function() {
      var $list;
      $list = $("#st_nav");
      return $list.children("li.album").each(function() {
        var $elem, $thumbs, $thumbs_wrapper, finalW;
        $elem = $(this);
        $thumbs_wrapper = $elem.find(".st_thumbs_wrapper");
        $thumbs = $thumbs_wrapper.children(":first");
        finalW = $thumbs.find("img").length * 183;
        $thumbs.css("width", finalW + "px");
        return makeScrollable($thumbs_wrapper, $thumbs);
      });
    };
    thumbClickHandler = function() {
      return $("#st_nav").find(".st_thumbs img").bind("click", function() {
        var $this;
        $this = $(this);
        return $("<img class=\"st_preview\"/>").load(function() {
          var $currImage;
          $this = $(this);
          $currImage = $("#st_main").children("img:first");
          $this.insertBefore($currImage);
          return $currImage.fadeOut(0, function() {
            return $(this).remove();
          });
        }).attr("src", $this.attr("alt"));
      }).bind("mouseenter", function() {
        return $(this).stop().animate({
          opacity: "1"
        });
      }).bind("mouseleave", function() {
        return $(this).stop().animate({
          opacity: "0.7"
        });
      });
    };
    makeScrollable = function($outer, $inner) {
      var divWidth, extra, lastElem;
      extra = 800;
      divWidth = $outer.width();
      $outer.css({
        overflow: "hidden"
      });
      lastElem = $inner.find("img:last");
      $outer.scrollLeft(0);
      return $outer.unbind("mousemove").bind("mousemove", function(e) {
        var containerWidth, left;
        containerWidth = lastElem[0].offsetLeft + lastElem.outerWidth() + 5 * extra;
        left = (e.pageX - $outer.offset().left) * (containerWidth - divWidth) / divWidth - extra;
        return $outer.scrollLeft(left);
      });
    };
    sideHomeHandler = function() {
      return $('#side_home, #mini_logo').bind('click', function(e) {
        e.preventDefault();
        return $("html, body").animate({
          scrollTop: 0
        }, "slow", function() {
          return $('#content_row').empty();
        });
      });
    };
    menuLinks = ['home', 'menu', 'photos', 'contact', 'testimonials'];
    sideMenuAction = function(item) {
      sideHomeHandler();
      return $("#" + item + "_side").bind('click', function(e) {
        e.preventDefault();
        $('#content_container').empty();
        $.get("/" + item, function(data) {
          $(data).appendTo($('#content_container'));
          if (item === 'photos') {
            Galleria.loadTheme('/javascripts/galleria/themes/classic/galleria.classic.min.js');
            Galleria.run('#galleria');
          }
          if (item === 'contact') {
            return contactHandler();
          }
        });
        return $("html, body").animate({
          scrollTop: $(document).height()
        }, "slow");
      });
    };
    sideMenuHandler = function() {
      var item, _i, _len;
      for (_i = 0, _len = menuLinks.length; _i < _len; _i++) {
        item = menuLinks[_i];
        sideMenuAction(item);
      }
      return $("#sdt_menu > li.skip-image").bind("mouseenter", function() {
        var $elem, $sub_menu, left;
        $elem = $(this);
        $sub_menu = $elem.find(".sdt_box");
        if ($sub_menu.length) {
          left = "170px";
          if ($elem.parent().children().length === $elem.index() + 1) {
            left = "170px";
          }
          return $sub_menu.show().animate({
            left: left,
            top: "20"
          }, 200);
        }
      }).bind("mouseleave", function() {
        var $elem, $sub_menu;
        $elem = $(this);
        $sub_menu = $elem.find(".sdt_box");
        if ($sub_menu.length) {
          return $sub_menu.hide().css("left", "0px");
        }
      });
    };
    $menu = $('#menu_holder');
    menuAction = function(item) {
      return $("#" + item).bind('click', function(e) {
        e.preventDefault();
        $('#content_row').empty();
        return $.get("/content", function(data) {
          var $content;
          $('#content_row').append(data);
          $content = $('#content');
          $content.css('margin-top', '2000px').css('text-align', 'center').css('margin-bottom', '100px');
          return $.get("/" + item, function(data) {
            $(data).appendTo($('#content_container'));
            sideMenuHandler();
            if (item === 'photos') {
              Galleria.loadTheme('/javascripts/galleria/themes/classic/galleria.classic.min.js');
              Galleria.run('#galleria');
            }
            if (item === 'contact') {
              contactHandler();
            }
            if (item === 'testimonials') {
              testimonials();
            }
            $("html, body").animate({
              scrollTop: $content.offset().top
            }, "slow");
            return $content.removeClass('hidden');
          });
        });
      });
    };
    for (_i = 0, _len = menuLinks.length; _i < _len; _i++) {
      item = menuLinks[_i];
      menuAction(item);
    }
    $menu.mouseover(function() {
      return $(this).css('margin-top', '100px');
    });
    $menu.mouseout(function() {
      return $(this).css('margin-top', '50px');
    });
    return contactHandler = function() {
      return $('#contact_form').bind('submit', function(e) {
        var $form, $submitButton;
        e.preventDefault();
        $form = $(this);
        $("#contact_info").hide();
        $submitButton = $form.find('button');
        $submitButton.html('Sending...');
        $submitButton.attr("disabled", "disabled").addClass("disabled");
        return $.ajax({
          type: 'POST',
          url: '/contact',
          data: $form.serializeArray(),
          success: function(data) {
            var $contentInfo;
            $contentInfo = $("#contact_info");
            $contentInfo.html(data).slideToggle();
            $('#contact_form')[0].reset();
            $submitButton.html("Send");
            return $submitButton.removeAttr("disabled").removeClass("disabled");
          },
          error: function(data) {
            $submitButton.html("Send");
            $submitButton.removeAttr("disabled").removeClass("disabled");
            return alert('email fail try again');
          }
        });
      });
    };
  });

}).call(this);
